<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Krovia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="../../map-base.css">
  <link rel="stylesheet" href="../../map-ui.css">
  <link rel="stylesheet" href="../../map-layers.css">
</head>
<body>
  <div id="map"></div>

  <div id="coords" style="position: fixed; bottom: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 4px; font-family: monospace; z-index: 1000;"></div>

  <div class="info-box" id="infoBox">
    <h3>Krovia</h3>
    <p>
    Population: ~44,693
    <br>
    <br> 
    Size: ~4021 km2
    <br>
    <br> 
    Location: Northeastern Latrian Peninsula
    <br>
    <br> 
    Description: Krovia is a land of twilight and endurance - Among the realms in Latria its among the oldest. 
    Its people speak in slow, old dialects of the Krovian Tongue and keep strict customs of invitation, hearth, and light. 
    By night the hilltop keeps awaken: crimson banners flutter, and courtly processions of vampires oversee governance. 
    By day, the mortal steward and the dьnь-sǫdъ manage trade, law, and diplomacy.
    <br>
    <br> 
    Climate: Sub-arctic maritime - short, cool summers (~7 °C average), long winters heavy with snow and sea-fog. The coasts remain ice-free due to warm currents, but inland valleys freeze for months.
    <br>
    <br> 
    Economy: Small but efficient, rooted in crafts, metalwork, and trade. The undead nobility favor long-lasting artistry: silver filigree, black-iron armory, fine glass, and dyed cloth. Mortals farm hardy grains and herd reindeer and shaggy oxen. Coastal towns export salt-fish, fur, and iron goods. Vampiric courts quietly fund mercantile ventures through mortal fronts.
    <br>
    <br>
    GDP: 683,910 GC
    <br>
    GDP per capita: 15.3 GC
    <br>
    (1 Gold Coin = $585)
    <br>
    <br>
    Military: Small, disciplined, and old. The čьrmnogardъ (vampiric knights and retainers) command mortal levies. Few in number but unmatched in night warfare and fort defense. Coastal watchtowers maintain signal-fires, and a modest fleet of black-hulled cutters patrols the Sea.
    <br>
    <br>
    Culture: Krovias people are reverent of hearth spirits, oaths, and ancestors. Common folk fear but respect their “nъťь-vladъje.” Superstitions run deep: mirrors are covered at dusk, and candles burn red wax during winter. Despite the vampiric rulers, art and song flourish - ballads of longing, endurance, and cold beauty fill the taverns.
    <br>
    <br> 
    Government: Noctarchatenal Monarchy ; A feudal monarchy ruled by vampiric nobility. The reigning Noctarch (High Lord or Lady) presides from the capital citadel.
    A mortal dьnь-vladъka, elected from selected and loyal mortal families, administers by daylight. Mortals may serve as mayors or scribes, but true power remains in the nocturnal courts.
    <br>
    <br>  
    Exports: Refined silver and black-iron weapons, Fine dyed fabrics and glassware, Salted fish and furs, Alchemical reagents (notably “Red Mercury”), Rare wines and preserved blood-tonics (for export to other vampiric houses)
    <br>
    <br>   
    Symbol & Colors: Silver - eternity and moonlight, Deep Blue - the night sea surrounding Krovia, Crimson - life’s blood, and the hidden power sustaining the realm
    <img src="../../images/latrian/krovia/flag_krovia.png" alt="Flag Krovia"  style="width:274px;height:334px;">
  </p>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // map setup
    const mapWidth = 2048;
    const mapHeight = 2048;
    const bounds = [[0, 0], [mapHeight, mapWidth]];
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1,
      maxZoom: 4,
      maxBounds: bounds,
      maxBoundsViscosity: 1.0
    }).fitBounds(bounds);

    // coords display
    map.on('mousemove', e => {
      const coordDiv = document.getElementById('coords');
      const x = Math.round(e.latlng.lng);
      const y = Math.round(e.latlng.lat);
      coordDiv.innerHTML = `X: ${x}, Y: ${y}`;
    });

    // base images (paths relative to this file)
    const blank = L.imageOverlay('../../images/latrian/krovia/krovia.webp', bounds).addTo(map);
    const temperature = L.imageOverlay('../../images/latrian/krovia/krovia_temperture.jpg', bounds);

    const baseMaps = {
      "Blank": blank,
      "Temperature": temperature
    };

    // single control (only one)
    L.control.layers(baseMaps, null).addTo(map);

    // info / invisible markers
    const invisibleIcon = L.divIcon({
      className: 'invisible-marker',
      iconSize: [25, 25],
      iconAnchor: [12, 12]
    });

    const townLayer = L.layerGroup();
    const citiesLayer = L.layerGroup();
    const temperatureLayer = L.layerGroup();

    // Towns
    const towns = [
      { name: "1", coords: [716, 1245], url: ".html" },
      { name: "2", coords: [875, 564], url: ".html" },
      { name: "3", coords: [1124, 1243], url: ".html" },
      { name: "4", coords: [1623, 1104], url: ".html" },
      { name: "5", coords: [1718, 1732], url: ".html" },
    ];
    towns.forEach(town => {
      const marker = L.marker(town.coords, { icon: invisibleIcon })
        .bindPopup(`<a class='popup-link' href='${town.url}'>${town.name}</a>`);
      townLayer.addLayer(marker);
    });

    map.addLayer(townLayer);

    // Temperature markers
    const tecoldZone = L.marker([591, 1166], {
      icon: L.divIcon({
        className: 'temp-label',
        html: '5°C',
        iconSize: [50, 20],
        iconAnchor: [25, 10]
      })
    });
    const ncoldCoords = [
      [855, 361],
      [378, 230],
      [1229, 347]
    ];
    ncoldCoords.forEach(coord => {
      const n = L.marker(coord, {
        icon: L.divIcon({
          className: 'temp-label',
          html: '-16°C',
          iconSize: [50, 20],
          iconAnchor: [25, 10]
        })
      });
      temperatureLayer.addLayer(n);
    });
    const kccoldCoords = [
      [567, 344],
      [671, 1477],
      [1197, 994]
    ];
    kccoldCoords.forEach(coord => {
      const m = L.marker(coord, {
        icon: L.divIcon({
          className: 'temp-label',
          html: '3°C',
          iconSize: [50, 20],
          iconAnchor: [25, 10]
        })
      });
      temperatureLayer.addLayer(m);
    });
    const ccoldCoords = [
      [360, 1051],
      [725, 856],
      [768, 1970]
    ];
    ccoldCoords.forEach(coord => {
      const c = L.marker(coord, {
        icon: L.divIcon({
          className: 'temp-label',
          html: '7°C',
          iconSize: [50, 20],
          iconAnchor: [25, 10]
        })
      });
      temperatureLayer.addLayer(c);
    });

    temperatureLayer.addLayer(tecoldZone);

    // unified baselayerchange handler
    map.on('baselayerchange', function(e) {
      // remove everything first
      map.removeLayer(townLayer);
      map.removeLayer(citiesLayer);
      map.removeLayer(temperatureLayer);

      if (e.name === "Blank") {
        map.addLayer(hamletLayer);
        map.addLayer(townLayer);
        map.addLayer(fortressLayer);
      } else if (e.name === "Temperature") {
        map.addLayer(temperatureLayer);
      }
    });

    // Info control (keeps button in control area and toggles infoBox)
    const InfoControl = L.Control.extend({
      onAdd: function() {
        const btn = L.DomUtil.create('button', 'info-toggle-btn');
        btn.innerHTML = 'ℹ️ Info';
        L.DomEvent.disableClickPropagation(btn);
        btn.onclick = function() {
          const box = document.getElementById('infoBox');
          box.classList.toggle('open'); // uses your CSS .info-box.open rules
        };
        return btn;
      },
      onRemove: function() {}
    });
    new InfoControl({ position: 'topright' }).addTo(map);

    // Back button control
    const BackButton = L.Control.extend({
      onAdd: function() {
        const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
        const btn = L.DomUtil.create('button', 'back-button', container);
        btn.innerHTML = '⬅️ Back';
        btn.title = 'Return to previous map';
        L.DomEvent.disableClickPropagation(btn);
        const previousMapURL = '../latrian.html';
        btn.onclick = function(e) {
          e.stopPropagation();
          window.location.href = previousMapURL;
        };
        return container;
      },
      onRemove: function() {}
    });
    new BackButton({ position: 'topleft' }).addTo(map);

  </script>
</body>
</html>
